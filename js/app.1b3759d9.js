(function(){"use strict";var e={8798:function(e,t,o){var l=o(3751),n=o(641);const i={id:"app-layout"},a={class:"app-header"},r={class:"main-nav"},s={class:"app-main"};var c={__name:"App",setup(e){return(e,t)=>{const o=(0,n.g2)("router-link"),l=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.CE)("div",i,[(0,n.Lk)("header",a,[t[4]||(t[4]=(0,n.Lk)("div",{class:"logo"},"城市探索者",-1)),(0,n.Lk)("nav",r,[(0,n.bF)(o,{to:"/"},{default:(0,n.k6)(()=>t[0]||(t[0]=[(0,n.eW)("首页")])),_:1,__:[0]}),(0,n.bF)(o,{to:"/map"},{default:(0,n.k6)(()=>t[1]||(t[1]=[(0,n.eW)("地图页")])),_:1,__:[1]}),(0,n.bF)(o,{to:"/map3D"},{default:(0,n.k6)(()=>t[2]||(t[2]=[(0,n.eW)("3D地图页")])),_:1,__:[2]}),(0,n.bF)(o,{to:"/about"},{default:(0,n.k6)(()=>t[3]||(t[3]=[(0,n.eW)("关于项目")])),_:1,__:[3]})])]),(0,n.Lk)("main",s,[(0,n.bF)(l)]),t[5]||(t[5]=(0,n.Lk)("footer",{class:"app-footer"},[(0,n.Lk)("p",null,"© 2025 秦亚会. All Rights Reserved.")],-1))])}}},u=o(6262);const d=(0,u.A)(c,[["__scopeId","data-v-3bfd67fa"]]);var p=d,v=o(5220);const f={class:"page-container"};function y(e,t){const o=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",f,[t[1]||(t[1]=(0,n.Lk)("h1",null,'欢迎来到 "城市探索者" 平台',-1)),t[2]||(t[2]=(0,n.Lk)("p",null,"在这里，我们将使用现代Web技术，探索和可视化我们生活的城市空间。",-1)),(0,n.bF)(o,{to:"/map"},{default:(0,n.k6)(()=>t[0]||(t[0]=[(0,n.Lk)("button",{class:"action-button"},"开始探索地图",-1)])),_:1,__:[0]})])}const m={},g=(0,u.A)(m,[["render",y],["__scopeId","data-v-d5840632"]]);var h=g,b=(o(8111),o(2489),o(1701),o(953)),k=o(4335),A=o(842),_=o.n(A),w=(o(1148),o(7588),o(810));const C=(0,w.nY)("mapStore",()=>{const e=(0,b.KR)([]),t=(0,b.KR)(null),o=(0,b.KR)({cityCount:0}),l=(0,b.KR)(null),i=(0,b.KR)(!1),a=(0,b.KR)("cluster"),r=(0,n.EW)(()=>t.value?t.value.feature.properties:null),s=(0,n.EW)({get:()=>!(e.value.length>0)||e.value.every(e=>e.visible),set:t=>e.value.forEach(e=>e.visible=t)});function c(t){e.value=t}function u(e){a.value=e}function d(e,o){t.value=o?{type:e,feature:o}:null}function p(e){o.value=e}async function v(e){if(e){i.value=!0;try{if(!window.allProvinceStats){const e=await k.A.get("/City_Explorer/province_city_stats.json");window.allProvinceStats=e.data}l.value=window.allProvinceStats[e]||[]}catch(t){console.error("获取城市统计数据失败:",t),l.value=null}finally{i.value=!1}}else l.value=null}return{provinces:e,cityDisplayMode:a,selectedFeature:t,mapStats:o,selectedProvinceCitiesStats:l,isLoadingStats:i,selectedFeatureProperties:r,provinceLayerVisible:s,initializeProvinces:c,setCityDisplayMode:u,setSelectedFeature:d,updateMapStats:p,fetchCityStatsForProvince:v}});var L=o(33),F=o(8548);const S={class:"panel-content"},E={class:"master-control"},R={class:"province-list"};var P={__name:"LayerControl",setup(e){const t=C(),o=(0,b.KR)(!1),i=(0,n.EW)({get(){return t.provinces.filter(e=>e.visible).map(e=>e.name)},set(e){t.provinces.forEach(t=>{t.visible=e.includes(t.name)})}});return(e,a)=>{const r=(0,n.g2)("el-icon"),s=(0,n.g2)("el-checkbox"),c=(0,n.g2)("el-divider"),u=(0,n.g2)("el-radio-button"),d=(0,n.g2)("el-radio-group"),p=(0,n.g2)("el-checkbox-group"),v=(0,n.g2)("el-card");return(0,n.uX)(),(0,n.CE)("div",{class:(0,L.C4)(["panel-wrapper",{collapsed:o.value}])},[(0,n.Lk)("div",{class:"toggle-button",onClick:a[0]||(a[0]=e=>o.value=!o.value)},[(0,n.bF)(r,null,{default:(0,n.k6)(()=>[o.value?((0,n.uX)(),(0,n.Wv)((0,b.R1)(F.ArrowRight),{key:0})):((0,n.uX)(),(0,n.Wv)((0,b.R1)(F.ArrowLeft),{key:1}))]),_:1})]),(0,n.bF)(v,{class:"layer-control-panel"},{header:(0,n.k6)(()=>a[3]||(a[3]=[(0,n.Lk)("span",null,"图层控制",-1)])),default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",S,[(0,n.Lk)("div",E,[(0,n.bF)(s,{modelValue:(0,b.R1)(t).provinceLayerVisible,"onUpdate:modelValue":a[1]||(a[1]=e=>(0,b.R1)(t).provinceLayerVisible=e),label:"所有省份",size:"large"},null,8,["modelValue"]),(0,n.bF)(c),a[7]||(a[7]=(0,n.Lk)("p",{class:"sub-title"},"城市图层显示模式:",-1)),(0,n.bF)(d,{"model-value":(0,b.R1)(t).cityDisplayMode,"onUpdate:modelValue":(0,b.R1)(t).setCityDisplayMode,size:"small"},{default:(0,n.k6)(()=>[(0,n.bF)(u,{label:"none"},{default:(0,n.k6)(()=>a[4]||(a[4]=[(0,n.eW)("不显示")])),_:1,__:[4]}),(0,n.bF)(u,{label:"fill"},{default:(0,n.k6)(()=>a[5]||(a[5]=[(0,n.eW)("显示为面")])),_:1,__:[5]}),(0,n.bF)(u,{label:"cluster"},{default:(0,n.k6)(()=>a[6]||(a[6]=[(0,n.eW)("显示为点(聚合)")])),_:1,__:[6]})]),_:1},8,["model-value","onUpdate:modelValue"]),(0,n.bF)(c),a[8]||(a[8]=(0,n.Lk)("p",{class:"sub-title"},"单独控制省份:",-1)),(0,n.Lk)("div",R,[(0,n.bF)(p,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e)},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,b.R1)(t).provinces,e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"province-item"},[(0,n.bF)(s,{label:e.name},null,8,["label"])]))),128))]),_:1},8,["modelValue"])])])],512),[[l.aG,!o.value]])]),_:1})],2)}}};const I=(0,u.A)(P,[["__scopeId","data-v-1e87ac90"]]);var D=I;const W={class:"card-header"},T={class:"feature-content"};var O={__name:"FeaturePanel",setup(e){const t=C(),o=(0,b.KR)(!1);return(e,i)=>{const a=(0,n.g2)("el-icon"),r=(0,n.g2)("el-button"),s=(0,n.g2)("el-descriptions-item"),c=(0,n.g2)("el-descriptions"),u=(0,n.g2)("el-empty"),d=(0,n.g2)("el-card");return(0,b.R1)(t).selectedFeature?((0,n.uX)(),(0,n.CE)("div",{key:0,class:(0,L.C4)(["panel-wrapper",{collapsed:o.value}])},[(0,n.Lk)("div",{class:"toggle-button",onClick:i[0]||(i[0]=e=>o.value=!o.value)},[(0,n.bF)(a,null,{default:(0,n.k6)(()=>[o.value?((0,n.uX)(),(0,n.Wv)((0,b.R1)(F.ArrowRightBold),{key:0})):((0,n.uX)(),(0,n.Wv)((0,b.R1)(F.ArrowLeftBold),{key:1}))]),_:1})]),(0,n.bF)(d,{class:"feature-panel"},{header:(0,n.k6)(()=>[(0,n.Lk)("div",W,[i[2]||(i[2]=(0,n.Lk)("span",null,"要素详情",-1)),(0,n.bF)(r,{icon:(0,b.R1)(F.Close),circle:"",size:"small",onClick:i[1]||(i[1]=e=>(0,b.R1)(t).setSelectedFeature(null,null)),title:"清空选择"},null,8,["icon"])])]),default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",T,[(0,b.R1)(t).selectedFeatureProperties&&Object.keys((0,b.R1)(t).selectedFeatureProperties).length>0?((0,n.uX)(),(0,n.Wv)(c,{key:0,column:1,border:"",size:"small",class:"description-table"},{default:(0,n.k6)(()=>[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)((0,b.R1)(t).selectedFeatureProperties,(e,t)=>((0,n.uX)(),(0,n.Wv)(s,{key:t,label:t},{default:(0,n.k6)(()=>[(0,n.eW)((0,L.v_)(e),1)]),_:2},1032,["label"]))),128))]),_:1})):((0,n.uX)(),(0,n.Wv)(u,{key:1,description:"无属性信息"}))],512),[[l.aG,!o.value]])]),_:1})],2)):(0,n.Q3)("",!0)}}};const x=(0,u.A)(O,[["__scopeId","data-v-5c9ca4f8"]]);var M=x,z=o(3680);const j={class:"panel-content"},X={key:0,class:"chart-wrapper"},K={key:1,class:"chart-wrapper"};var B={__name:"StatisticsChart",setup(e){const t=C(),o=(0,b.KR)(!1),i=(0,b.KR)(null),a=(0,b.KR)(null);let r=null,s=null;const c=(0,n.EW)(()=>t.selectedProvinceCitiesStats&&t.selectedProvinceCitiesStats.length>0),u=(0,n.EW)(()=>t.selectedFeature&&"province"===t.selectedFeature.type?`${t.selectedFeature.feature.properties.name} 城市面积占比`:"城市面积占比");function d(){i.value&&(r||(r=z.Ts(i.value)),r.setOption({series:[{type:"gauge",detail:{formatter:"{value}"},data:[{value:t.mapStats.cityCount,name:"城市数量"}]}]}))}function p(){if(a.value&&c.value){s||(s=z.Ts(a.value));const e=t.selectedProvinceCitiesStats.map(e=>({name:e.city_name,value:(e.area_sqm/1e6).toFixed(2)})).sort((e,t)=>t.value-e.value).slice(0,10);s.setOption({title:{text:"TOP10 城市面积 (km²)",left:"center",textStyle:{fontSize:12}},tooltip:{trigger:"item",formatter:"{b}: {c} km² ({d}%)",confine:!0},series:[{type:"pie",radius:"70%",data:e,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})}}return(0,n.wB)(()=>[t.selectedFeature,t.mapStats],()=>{(0,n.dY)(()=>{c.value?(r&&(r.dispose(),r=null),p()):(s&&(s.dispose(),s=null),d())})},{deep:!0,immediate:!0}),(0,n.wB)(o,e=>{e||setTimeout(()=>{s&&s.resize(),r&&r.resize()},350)}),(0,n.hi)(()=>{r&&r.dispose(),s&&s.dispose()}),(e,r)=>{const s=(0,n.g2)("el-icon"),d=(0,n.g2)("el-card"),p=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",{class:(0,L.C4)(["panel-wrapper",{collapsed:o.value}])},[(0,n.Lk)("div",{class:"toggle-button",onClick:r[0]||(r[0]=e=>o.value=!o.value)},[(0,n.bF)(s,null,{default:(0,n.k6)(()=>[o.value?((0,n.uX)(),(0,n.Wv)((0,b.R1)(F.ArrowRight),{key:0})):((0,n.uX)(),(0,n.Wv)((0,b.R1)(F.ArrowLeft),{key:1}))]),_:1})]),(0,n.bo)(((0,n.uX)(),(0,n.Wv)(d,{class:"chart-panel","element-loading-text":"正在查询分析..."},{default:(0,n.k6)(()=>[(0,n.bo)((0,n.Lk)("div",j,[c.value?((0,n.uX)(),(0,n.CE)("div",X,[(0,n.Lk)("h4",null,(0,L.v_)(u.value),1),(0,n.Lk)("div",{ref_key:"pieChartDom",ref:a,style:{width:"100%",height:"250px"}},null,512)])):((0,n.uX)(),(0,n.CE)("div",K,[r[1]||(r[1]=(0,n.Lk)("h4",null,"当前视野内城市统计",-1)),(0,n.Lk)("div",{ref_key:"gaugeChartDom",ref:i,style:{width:"100%",height:"250px"}},null,512)]))],512),[[l.aG,!o.value]])]),_:1})),[[p,(0,b.R1)(t).isLoadingStats]])],2)}}};const N=(0,u.A)(B,[["__scopeId","data-v-1d8e4870"]]);var V=N;const G={class:"map-page-container"},H="KNvedDoPlLw61gg1Kn4l";var U={__name:"MapPage",setup(e){const t=(0,b.KR)(null);let o=null;const l=C();let i=null;async function a(){try{const[e,t]=await Promise.all([fetch("/City_Explorer/provinces_of_china.json"),fetch("/City_Explorer/china_cities_points.json")]),n=await e.json(),a=await t.json(),u=n.features.map(e=>({id:e.properties.name,name:e.properties.name,visible:!0,feature:e}));l.initializeProvinces(u),o.addSource("provinces-source",{type:"geojson",data:n,promoteId:"name"}),o.addLayer({id:"provinces-layer",type:"fill",source:"provinces-source",paint:{"fill-color":["case",["boolean",["feature-state","selected"],!1],"#FFD700",["boolean",["feature-state","hover"],!1],"#FFA500","#088"],"fill-opacity":.5,"fill-outline-color":"#fff"}});const d="https://api.maptiler.com/tiles/0198dc07-9e93-7368-9269-00c754ca38a4/tiles.json?key=KNvedDoPlLw61gg1Kn4l",p=await k.A.get(d),v=p.data.vector_layers[0].id;console.log("侦察到的真实Source Layer名称是:",v),o.getSource("cities-vt-source")||o.addSource("cities-vt-source",{type:"vector",url:d}),o.getLayer("cities-vt-layer")||o.addLayer({id:"cities-vt-layer",type:"fill",source:"cities-vt-source","source-layer":v,layout:{visibility:l.cityLayerVisible?"visible":"none"},paint:{"fill-color":"#f08","fill-opacity":.4}}),o.addSource("highlight-source",{type:"geojson",data:null}),o.addLayer({id:"highlight-layer",type:"fill",source:"highlight-source",paint:{"fill-color":"#FFFF00","fill-opacity":.7}}),i=o.getSource("highlight-source"),o.getSource("city-points-source")||o.addSource("city-points-source",{type:"geojson",data:a,cluster:!0,clusterMaxZoom:14,clusterRadius:50}),o.getLayer("clusters-layer")||o.addLayer({id:"clusters-layer",type:"circle",source:"city-points-source",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#51bbd6",100,"#f1f075",750,"#f28cb1"],"circle-radius":["step",["get","point_count"],20,100,30,750,40]}}),o.getLayer("cluster-count-layer")||o.addLayer({id:"cluster-count-layer",type:"symbol",source:"city-points-source",filter:["has","point_count"],layout:{"text-field":"{point_count_abbreviated}","text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":12}}),o.getLayer("unclustered-point-layer")||o.addLayer({id:"unclustered-point-layer",type:"circle",source:"city-points-source",filter:["!",["has","point_count"]],paint:{"circle-color":"#11b4da","circle-radius":6,"circle-stroke-width":1,"circle-stroke-color":"#fff"}}),o.on("click","clusters-layer",e=>{const t=o.queryRenderedFeatures(e.point,{layers:["clusters-layer"]}),l=t[0].properties.cluster_id;o.getSource("city-points-source").getClusterExpansionZoom(l,(e,l)=>{e||o.easeTo({center:t[0].geometry.coordinates,zoom:l})})}),r(),s(),c(),o.on("moveend",c),o.on("zoomend",c),o.on("mouseenter","clusters-layer",()=>{o.getCanvas().style.cursor="pointer"}),o.on("mouseleave","clusters-layer",()=>{o.getCanvas().style.cursor=""})}catch(e){console.error("地图设置失败:",e)}}function r(){let e=null;o.on("click",e=>{const t=o.queryRenderedFeatures(e.point,{layers:["provinces-layer"]}),n=o.queryRenderedFeatures(e.point,{layers:["cities-vt-layer"]});n.length>0?l.setSelectedFeature("city",n[0]):t.length>0?l.setSelectedFeature("province",t[0]):l.setSelectedFeature(null,null)}),o.on("mousemove","provinces-layer",t=>{o.getCanvas().style.cursor="pointer",t.features.length>0&&(e&&o.setFeatureState({source:"provinces-source",id:e},{hover:!1}),e=t.features[0].properties.name,o.setFeatureState({source:"provinces-source",id:e},{hover:!0}))}),o.on("mouseleave","provinces-layer",()=>{o.getCanvas().style.cursor="",e&&o.setFeatureState({source:"provinces-source",id:e},{hover:!1}),e=null})}function s(){let e=null;(0,n.wB)(()=>l.selectedFeature,t=>{if(o&&o.isStyleLoaded()&&i)if(e&&o.setFeatureState({source:"provinces-source",id:e},{selected:!1}),e=null,i.setData({type:"FeatureCollection",features:[]}),t){const{type:n,feature:a}=t;"province"===n?(e=a.properties.name,o.setFeatureState({source:"provinces-source",id:e},{selected:!0}),l.fetchCityStatsForProvince(e)):"city"===n&&(i.setData(a),l.fetchCityStatsForProvince(null))}else l.fetchCityStatsForProvince(null);else console.warn("Watch triggered, but map or highlightSource is not ready.")},{deep:!0}),(0,n.wB)(()=>l.provinces,e=>{if(!o||!o.getLayer("provinces-layer"))return;const t=e.filter(e=>e.visible).map(e=>e.name);o.setFilter("provinces-layer",["in","name",...t])},{deep:!0}),(0,n.wB)(()=>l.cityDisplayMode,e=>{o&&(o.setLayoutProperty("cities-vt-layer","visibility","fill"===e?"visible":"none"),["clusters-layer","cluster-count-layer","unclustered-point-layer"].forEach(t=>{o.getLayer(t)&&o.setLayoutProperty(t,"visibility","cluster"===e?"visible":"none")}))})}function c(){if(!o||!o.isStyleLoaded())return;const e=o.queryRenderedFeatures({layers:["cities-vt-layer"]}),t={cityCount:e.length};l.updateMapStats(t)}return _().accessToken=H,(0,n.sV)(()=>{const e=`https://api.maptiler.com/maps/streets-v2/style.json?key=${H}`;o=new(_().Map)({container:t.value,style:e,center:[104,35],zoom:3.5}),o.on("load",a)}),(0,n.hi)(()=>{o&&o.remove()}),(e,o)=>((0,n.uX)(),(0,n.CE)("div",G,[(0,n.bF)(D),(0,n.bF)(M),(0,n.bF)(V),(0,n.Lk)("div",{ref_key:"mapContainer",ref:t,class:"map-container"},null,512)]))}};const $=(0,u.A)(U,[["__scopeId","data-v-01297777"]]);var Y=$;const J={class:"about-container"};function q(e,t){return(0,n.uX)(),(0,n.CE)("div",J,t[0]||(t[0]=[(0,n.Lk)("div",{class:"content-card"},[(0,n.Lk)("h2",null,"关于项目"),(0,n.Lk)("p",null,[(0,n.eW)(" 本项目由 "),(0,n.Lk)("strong",null,"秦亚会"),(0,n.eW)(" 基于 Vue 3, Vue Router, Pinia, Element Plus, Mapbox GL JS 等现代前端技术构建。 ")]),(0,n.Lk)("p",null," 旨在学习和实践WebGIS开发的全链路流程，从后端的空间数据处理（PostGIS）、服务发布（GeoServer），到前端的组件化开发与交互式可视化。 ")],-1)]))}const Z={},Q=(0,u.A)(Z,[["render",q],["__scopeId","data-v-fc6d4eb0"]]);var ee=Q,te=(o(4114),o(6009)),oe=o(9526),le=o(7297),ne=o(5584),ie=o(7702),ae=o(7556),re=o(1978),se=o(7980),ce=o(4847),ue=o(3467),de=o(2612),pe=o(8027),ve=o(1476),fe=o(8609),ye=o(3798),me=o(4321),ge=o(7536),he=o(8017),be=o(2145),ke=o(1005),Ae=o(749),_e=o(5817),we=o(2558),Ce=o(4067),Le=o(8261),Fe=o(6067),Se=o(1446),Ee=o(6881),Re=o(9785),Pe=o(898),Ie=o(2569);const De={class:"map-page-container"},We={class:"analysis-tools"};var Te={__name:"Map3DPage",setup(e){window.CESIUM_BASE_URL="cesium/";const t=(0,b.KR)(null);let o=null;const l=(0,b.KR)(!1);let i=null;const a=[];let r=null;async function s(){if(o)try{console.log("开始加载基础场景（影像，地形，建筑）...");const[t,l,n]=await Promise.all([le.A.fromAssetId(3),ne.A(),ie.A()]);o.imageryProvider=t,o.terrainProvider=l,o.scene.primitives.add(n),o.scene.globe.depthTestAgainstTerrain=!0,console.log("基础场景加载成功！");try{console.log("正在创建动态飞行轨迹...");const e=new ae.A,t=re.A.fromDate(new Date(Date.UTC(2025,7,9,16,0,0))),l=re.A.addSeconds(t,3600,new re.A),n=se.A.fromDegrees(116.39,39.91,5e3);e.addSample(t,n);const i=re.A.addSeconds(t,1800,new re.A),a=se.A.fromDegrees(108.95,34.26,5e3);e.addSample(i,a);const r=se.A.fromDegrees(121.47,31.23,5e3);e.addSample(l,r);const s="/City_Explorer/models/CesiumAir/Cesium_Air.glb",c=o.entities.add({availability:new ce.A([new ue.A({start:t,stop:l})]),position:e,orientation:new de.A(e),model:{uri:s,minimumPixelSize:128,colorBlendMode:pe.A.HIGHLIGHT,silhouetteColor:ve.A.fromCssColorString("#00BFFF"),silhouetteSize:2,color:ve.A.LEMONCHIFFON,shadows:fe.A.ENABLED},path:new ye.A({resolution:1,trailTime:20,leadTime:0,material:new me.A({glowPower:.2,color:ve.A.AQUAMARINE,taperPower:.5}),width:15})});o.clock.startTime=t.clone(),o.clock.stopTime=l.clone(),o.clock.currentTime=t.clone(),o.clock.clockRange=ge.A.LOOP_STOP,o.timeline.zoomTo(t,l),o.trackedEntity=c,console.log("动态飞机实体已创建！动画即将开始。")}catch(e){console.error("创建动态轨迹时发生错误：",e)}const i=new he.A({color:{conditions:[["${feature['cesium#estimatedHeight']} >= 100","color('red')"],["${feature['cesium#estimatedHeight']} >= 50","color('orange')"],["${feature['cesium#estimatedHeight']} >= 20","color('yellow')"],["true","color('white', 0.8)"]]}});n.style=i,console.log("已为建筑应用数据驱动的3D样式！"),console.log("开始加载自定义城市面数据...");const a="/City_Explorer/cities.json",r=await be.A.load(a,{stroke:ve.A.fromCssColorString("#FFD700").withAlpha(.8),strokeWidth:2,fill:ve.A.fromCssColorString("#FFD700").withAlpha(.2)});await o.dataSources.add(r),console.log("自定义城市面数据加载成功！");const s=r.entities.values;for(const e of s)e.polygon&&(e.polygon.material=ve.A.ORANGE.withAlpha(.5),e.polygon.extrudedHeight=2e4),e.description=`<h2>${e.properties.city_name?.getValue()}</h2><p>这是一个从我们自己后端加载的城市面！</p>`;p(),o.entities.add({id:"beijing-poi",name:"中华人民共和国首都",position:se.A.fromDegrees(116.39,39.91,100),point:new ke.A({color:ve.A.RED,pixelSize:10,outlineColor:ve.A.WHITE,outlineWidth:2}),label:new Ae.A({text:"北京",font:"16pt sans-serif",fillColor:ve.A.WHITE,outlineColor:ve.A.BLACK,outlineWidth:2,style:_e.A.FILL_AND_OUTLINE,verticalOrigin:we.A.BOTTOM,pixelOffset:new Ce.A(0,-12)})}),o.entities.add({id:"bj-sh-line",name:"京沪线",polyline:new Le.A({positions:se.A.fromDegreesArrayHeights([116.39,39.91,2e4,121.47,31.23,2e4]),width:3,material:ve.A.CYAN,clampToGround:!0})}),console.log("手动创建的京沪线实体已添加！")}catch(e){console.error("在设置地图图层和交互时发生错误: ",e)}}function c(){l.value=!l.value,l.value?console.log("视线分析模式已激活。请在地球上点击选择起点。"):(console.log("视线分析模式已关闭。"),u())}function u(){a.forEach(e=>o.entities.remove(e)),a.length=0,i=null}function d(e){if(!i||!e)return;const t=se.A.normalize(se.A.subtract(e,i,new se.A),new se.A),l=new Fe.A(i,t),n=o.scene.pickFromRay(l,[]),r=se.A.distance(i,e);let s=ve.A.GREEN;if(Se.A(n)&&se.A.distance(i,n.position)<r){s=ve.A.RED;const e=o.entities.add({position:n.position,point:{color:ve.A.YELLOW,pixelSize:8,outlineWidth:2,outlineColor:ve.A.BLACK}});a.push(e)}const c=o.entities.add({polyline:{positions:[i,e],width:3,material:s,clampToGround:!1}});a.push(c)}function p(){o&&(r=new Ee.A(o.scene.canvas),r.setInputAction(e=>{l.value?v(e):f(e)},Re.A.LEFT_CLICK))}function v(e){const t=o.scene.pickPosition(e.position);if(Se.A(t))if(i){const e=t,l=o.entities.add({position:t,name:"视线分析终点",description:"这是视线分析的终点。",point:{color:ve.A.RED,pixelSize:10,outlineColor:ve.A.WHITE,outlineWidth:2}});a.push(l),d(e),i=null}else{u(),i=t;const e=o.entities.add({position:t,name:"视线分析起点",description:"这是视线分析的起点。",point:{color:ve.A.LIME,pixelSize:10,outlineColor:ve.A.WHITE,outlineWidth:2}});a.push(e)}}function f(e){const t=o.scene.pick(e.position);if(Se.A(t)){if(t.id instanceof Pe.A){const e=t.id;return console.log(`拾取到实体(Entity): ${e.name||e.id}`),o.selectedEntity=e,void o.flyTo(e)}if(t instanceof Ie.A){const e=t;console.log("拾取到3D建筑要素！");const l=e.getPropertyIds();console.log("--- 属性详情 ---");const n={};return l.forEach(t=>{const o=e.getProperty(t);n[t]=o,console.log(`${t}:`,o)}),void(o.selectedEntity=new Pe.A({name:`建筑 (ID: ${e.featureId})`,description:y(n)}))}}else console.log("点击到了空白处。")}function y(e){let t='<table class="cesium-infoBox-defaultTable"><tbody>';for(const o in e)if(Object.prototype.hasOwnProperty.call(e,o)){const l=e[o];t+=`<tr><th>${o}</th><td>${l}</td></tr>`}return t+="</tbody></table>",t}return(0,n.sV)(async()=>{t.value&&(te.A.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIwZGYzMWM3Ny1jZDhhLTQ2ZDktYTAzYi00ZTgyZGYxNzkzOTkiLCJpZCI6MzI5Nzk5LCJpYXQiOjE3NTQ1ODA1NDJ9.DB8BghGI977awRcqhMPn8B73YNmRtagq4wVTJKM-F2k",o=new oe.A(t.value,{imageryProvider:void 0,terrainProvider:void 0,animation:!0,timeline:!0,geocoder:!0,homeButton:!0,sceneModePicker:!0,baseLayerPicker:!0,navigationHelpButton:!0,shadows:!1,shouldAnimate:!0}),s())}),(0,n.hi)(()=>{o&&(o.destroy(),o=null),r&&r.destroy()}),(e,o)=>{const i=(0,n.g2)("el-button");return(0,n.uX)(),(0,n.CE)("div",De,[(0,n.Lk)("div",We,[(0,n.bF)(i,{onClick:c,type:l.value?"success":"primary"},{default:(0,n.k6)(()=>[(0,n.eW)((0,L.v_)(l.value?"分析中 (点击结束)":"开始视线分析"),1)]),_:1},8,["type"])]),(0,n.Lk)("div",{id:"cesiumContainer",ref_key:"cesiumContainer",ref:t},null,512)])}}};const Oe=(0,u.A)(Te,[["__scopeId","data-v-3e00ef34"]]);var xe=Oe;const Me=[{path:"/",name:"Home",component:h},{path:"/map",name:"Map",component:Y},{path:"/map3D",name:"Map3D",component:xe},{path:"/about",name:"About",component:ee}],ze=(0,v.aE)({history:(0,v.LA)("/City_Explorer/"),routes:Me});var je=ze,Xe=o(3390);o(4188);const Ke=(0,l.Ef)(p);for(const[Be,Ne]of Object.entries(F))Ke.component(Be,Ne);Ke.use((0,w.Ey)()),Ke.use(je),Ke.use(Xe.A),Ke.mount("#app")}},t={};function o(l){var n=t[l];if(void 0!==n)return n.exports;var i=t[l]={id:l,loaded:!1,exports:{}};return e[l].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=e,function(){var e=[];o.O=function(t,l,n,i){if(!l){var a=1/0;for(u=0;u<e.length;u++){l=e[u][0],n=e[u][1],i=e[u][2];for(var r=!0,s=0;s<l.length;s++)(!1&i||a>=i)&&Object.keys(o.O).every(function(e){return o.O[e](l[s])})?l.splice(s--,1):(r=!1,i<a&&(a=i));if(r){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[l,n,i]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var l in t)o.o(t,l)&&!o.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){o.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,l){var n,i,a=l[0],r=l[1],s=l[2],c=0;if(a.some(function(t){return 0!==e[t]})){for(n in r)o.o(r,n)&&(o.m[n]=r[n]);if(s)var u=s(o)}for(t&&t(l);c<a.length;c++)i=a[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(u)},l=self["webpackChunkmy_first_app"]=self["webpackChunkmy_first_app"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=o.O(void 0,[504],function(){return o(8798)});l=o.O(l)})();
//# sourceMappingURL=app.1b3759d9.js.map